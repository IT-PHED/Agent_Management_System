@model IEnumerable<Fedco.PHED.Agent.management.Web.Models.AgentModel>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}


<div>

    <table class="table table-striped table-bordered" style="width:99%" id="agentTable">
        <thead>
            <tr>
                <th>
                    Agent Code
                </th>
                <th>
                    Agent Name
                </th>
                <th>
                    Registartion Number
                </th>
                <th>
                    Balance
                </th>
                <th>
                    Commission
                </th>
                <th>

                </th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in ViewBag.agents)
            {
                <tr>
                    <td>
                        @item.AgentCode
                    </td>
                    <td>
                        @item.AgentName
                    </td>
                    <td>
                        @item.RegistartionNumber
                    </td>
                    <td>
                        @Math.Round(item.Balance, 2)
                    </td>

                    <td>
                        @item.Commission
                    </td>
                    <td>
                        @if (item.ApprovalStatus == "APPROVED" && item.Status == true)
    {
                    

    if (item.isTransferApproved == 1)
    {
                    @Html.ActionLink("Transfer", "TransferToAgent", "Transaction", new { AgentCode = item.AgentCode, Balance = 0 }, new { @class = "btn btn-primary btn-transfer" })
}
if (item.isReversalApproved == 1)
{
                    @Html.ActionLink("Reversal", "ReversalFromAgent", "Transaction", new { AgentCode = item.AgentCode, Balance = 0 }, new { @class = "btn btn-primary btn-transfer" })
}
                    

}
else
{
                    @item.ApprovalStatus
}
                        @Html.ActionLink("IMEI", "AgentIMEI", "Transaction", new { agentId = item.AgentId }, new { @class = "btn btn-primary btn-transfer" })
                    </td>
                    <td>
                        
                        <label class="switch">

                            <input type="checkbox" class="isActive" agentid=@item.AgentId checked=@item.Status />

                            <div class="slider round">
                            </div>
                        </label>
                    </td>
                    <td>
                        @Html.ActionLink("Edit", "EditAgent", "Account", new { agentId = item.AgentId }, new { @class = "btn btn-primary btn-transfer" })
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script src="~/Scripts/jquery-3.3.1.js"></script>
<script src="~/Scripts/jquery.dataTables.min.js"></script>
<script src="~/Scripts/dataTables.bootstrap4.min.js"></script>
<script src="~/Scripts/dataTables.buttons.min.js"></script>
<script src="~/Scripts/buttons.bootstrap4.min.js"></script>
<script src="~/Scripts/jszip.min.js"></script>
<script src="~/Scripts/pdfmake.min.js"></script>
<script src="~/Scripts/vfs_fonts.js"></script>
<script src="~/Scripts/buttons.html5.min.js"></script>
<script src="~/Scripts/buttons.print.min.js"></script>


<link rel="stylesheet" href="~/Content/dataTables.bootstrap4.min.css" />
<script type="text/javascript">
    $(function () {


        $.noConflict();


        var table = $('#agentTable').DataTable({
            lengthChange: false,
            buttons: [ 'excel', 'pdf']
        });

        table.buttons().container()
            .appendTo('#agentTable_wrapper .col-md-6:eq(0)');

    });
  $(document).ready(function () {
    $(".isActive").change(function () {


      if (confirm("Are you sure you want to De-Activate/Activate user?")) {
        var currentObj = this;

          $.get('@Url.Action("UpdateUserStatus", "Admin", null, Request.Url.Scheme)' + '?status=' + this.checked + "&agentid=" + this.attributes["agentid"].value, function (data) {

            if (data != null) {
              if (currentObj.checked) {
                $(currentObj).parent().parent().parent().find('.btn-transfer').css("display", "block");
                $(currentObj).parent().parent().parent().find('.btn-transfer').css("width", "75px");
              } else {

                $(currentObj).parent().parent().parent().find('.btn-transfer').css("display", "none");
              }
      }
      else {

      }
      }).fail(function () {

      });
        }
        else {
          this.checked = !this.checked;
          return false;
        }


    });
  });
</script>
