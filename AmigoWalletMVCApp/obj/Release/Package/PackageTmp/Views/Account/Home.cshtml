@model IEnumerable<Fedco.PHED.Agent.management.Web.Models.AgentModel>

@{
  ViewBag.Title = "Home";

}
 @if (ViewBag.Adim == true)
  {
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
  }
  else
  {
    Layout = "~/Views/Shared/_Layout.cshtml";
  }

<div class="btn-group btn-breadcrumb col-md-12" style="margin-bottom:5px">

  <a href="@Url.Action("Home", "Account")" class="btn btn-default"><i class="glyphicon glyphicon-home"></i></a>
  <a href="#" class="btn btn-default">Agents Credits</a>

</div>
<div>
  <div class="col-md-12">
    <div class="row">
      <div class="col-md-12">
        <div class="well">
          @* Shows user total balance *@
          <h4><strong>My Wallet Balance</strong></h4>
          @{
            Html.RenderPartial("_ViewBalance");
          }
        </div>
      </div>
    </div>

    <div>
      <div class="col-md-12">
        <table class="table table-striped table-bordered" style="width:99%" id="agentTable">
          <thead>
              <tr>
                  <th>
                      Agent Code
                  </th>
                  <th>
                      Agent Name
                  </th>
                  <th>
                      Registartion Number
                  </th>
                  <th>
                      Balance
                  </th>
                  <th>
                      Commission
                  </th>
                  <th>

                  </th>
                  <th></th>
                  <th></th>
              </tr>
          </thead>
          <tbody>
            @foreach (var item in ViewBag.agents)
            {
            <tr>
              <td>
                @item.AgentCode
              </td>
              <td>
                @item.AgentName
              </td>
              <td>
                @item.RegistartionNumber
              </td>
              <td>
                @Math.Round(item.Balance, 2)
              </td>

              <td>
                @item.Commission
              </td>
              <td>

                  @if (ViewBag.isAmountApproved == 0)
    {
              <span>Transfer Approval in pending.</span>
}
else if ((ViewBag.isAmountApproved == null || ViewBag.isAmountApproved == 1) && item.Status == true)
{
              @Html.ActionLink("Transfer", "TransferToAgent", "Transaction", new { AgentCode = item.AgentCode, Balance = ViewBag.ViewBalance }, new { @class = "btn btn-primary" })
              @Html.ActionLink("Reversal", "ReversalFromAgent", "Transaction", new { AgentCode = item.AgentCode, Balance = ViewBag.ViewBalance }, new { @class = "btn btn-primary" })

}
                  @Html.ActionLink("IMEI", "AgentIMEI", "Transaction", new { agentId = item.AgentId }, new { @class = "btn btn-primary btn-transfer" })
                 
              </td>
              <td>

                <label class="switch">

                  <input type="checkbox" class="isActive" agentid=@item.AgentId checked=@item.Status />

                  <div class="slider round">
                  </div>
                </label>
              </td>
              <td>
                  @Html.ActionLink("Edit", "EditAgent", "Account", new { agentId = item.AgentId }, new { @class = "btn btn-primary btn-transfer" })
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>



    </div>
  </div>


</div>
<script src="~/Scripts/jquery.dataTables.min.js"></script>
<script src="~/Scripts/dataTables.bootstrap4.min.js"></script>
<script src="~/Scripts/dataTables.buttons.min.js"></script>
<script src="~/Scripts/buttons.bootstrap4.min.js"></script>
<script src="~/Scripts/dataTables.select.min.js"></script>
<script src="~/Scripts/dataTables.editor.min.js"></script>
<script src="~/Scripts/jszip.min.js"></script>
<script src="~/Scripts/pdfmake.min.js"></script>
<script src="~/Scripts/vfs_fonts.js"></script>
<script src="~/Scripts/buttons.html5.min.js"></script>
<script src="~/Scripts/buttons.print.min.js"></script>

<link rel="stylesheet" href="~/Content/dataTables.bootstrap4.min.css" />
<script type="text/javascript">
    $(function () {
    $.noConflict();
    var table = $('#agentTable').DataTable({
        lengthChange: false,
        "columns": [
            { "width": "12%" },
            { "width": "20%" },
            null,
            null,
            { "width": "5%" },
            null,
            null,
            null
        ],
      buttons: ['excel', 'pdf', 'pageLength'],
      "scrollX": true,
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
    });

    table.buttons().container()
      .appendTo('#agentTable_wrapper .col-md-6:eq(0)');

    });

    $(document).ready(function () {
       
      $(".isActive").change(function () {
        if (confirm("Are you sure you want to De-Activate/Activate user?")) {
          var currentObj = this;
          $.get('@Url.Action("UpdateUserStatus", "Account", null, Request.Url.Scheme)' + '?status=' + this.checked + "&agentid=" + this.attributes["agentid"].value, function (data) {
            if (data != null) {
              if (currentObj.checked) {
                $(currentObj).parent().parent().parent().find('.btn-transfer').css("display", "block");
                $(currentObj).parent().parent().parent().find('.btn-transfer').css("width", "75px");
              } else {

                $(currentObj).parent().parent().parent().find('.btn-transfer').css("display", "none");
              }
      }
      else {
       
      }
      }).fail(function () {

      });
        }
        else {
          this.checked = !this.checked;
          return false;
        }
    });
  });
</script>

